<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Implementation of an Isoparametric Membrane Finite Element</title>
    
    <!-- MathJax Configuration -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['\\(', '\\)']],
                displayMath: [['\\[', '\\]']],
                processEscapes: true
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>
    
    <style>
        :root {
            --primary-color: #1a365d;
            --secondary-color: #2c5282;
            --accent-color: #38a169;
            --bg-light: #f7fafc;
            --bg-code: #1e1e1e;
            --border-color: #e2e8f0;
            --text-color: #2d3748;
            --highlight-yellow: #fef3c7;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            line-height: 1.8;
            color: var(--text-color);
            background: #fff;
            padding: 40px 20px;
        }

        .document {
            max-width: 1000px;
            margin: 0 auto;
        }

        /* Title Page */
        .title-page {
            text-align: center;
            padding: 80px 40px;
            background: var(--primary-color);
            color: white;
            border-radius: 12px;
            margin-bottom: 60px;
        }

        .title-page h1 {
            font-size: 2.5rem;
            margin-bottom: 40px;
            line-height: 1.3;
        }

        .title-page .course-info {
            font-size: 1.4rem;
            margin-bottom: 40px;
        }

        .title-page .author {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* Section Styling */
        section {
            margin: 50px 0;
            padding: 30px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        h2 {
            color: var(--primary-color);
            font-size: 1.8rem;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid var(--secondary-color);
        }

        h3 {
            color: var(--secondary-color);
            font-size: 1.4rem;
            margin: 25px 0 15px 0;
        }

        h4 {
            color: var(--secondary-color);
            font-size: 1.2rem;
            margin: 20px 0 10px 0;
        }

        p {
            margin: 15px 0;
            text-align: justify;
        }

        ul, ol {
            margin: 15px 0 15px 30px;
        }

        li {
            margin: 8px 0;
        }

        /* Figures */
        figure {
            margin: 30px 0;
            text-align: center;
        }

        figure img {
            max-width: 100%;
            height: auto;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        figcaption {
            margin-top: 12px;
            font-style: italic;
            color: #666;
            font-size: 0.95rem;
        }

        /* Code Blocks */
        .code-block {
            background: var(--bg-code);
            color: #d4d4d4;
            padding: 20px;
            border-radius: 6px;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9rem;
            margin: 20px 0;
            line-height: 1.5;
        }

        .code-block .comment {
            color: #6a9955;
        }

        .code-block .keyword {
            color: #569cd6;
        }

        .code-block .highlight {
            color: #ce9178;
        }

        .code-inline {
            background: #f1f5f9;
            padding: 2px 8px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
        }

        /* Data Structure Display */
        .data-structure {
            background: #f8f9fa;
            border-left: 4px solid var(--secondary-color);
            padding: 20px;
            margin: 20px 0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.85rem;
            overflow-x: auto;
        }

        .data-structure .field-name {
            color: var(--primary-color);
            font-weight: bold;
        }

        .data-structure .field-desc {
            color: #666;
            margin-left: 20px;
        }

        /* Highlighted Boxes */
        .highlight-box {
            background: var(--highlight-yellow);
            padding: 15px 20px;
            border-radius: 6px;
            margin: 15px 0;
        }

        .info-box {
            background: #e8f4f8;
            border-left: 4px solid var(--secondary-color);
            padding: 15px 20px;
            margin: 20px 0;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            font-size: 0.95rem;
        }

        th, td {
            padding: 12px 15px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        th {
            background: var(--primary-color);
            color: white;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background: var(--bg-light);
        }

        /* Matrix Display */
        .matrix-container {
            margin: 20px 0;
            overflow-x: auto;
        }

        .matrix-display {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 6px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.8rem;
            white-space: pre;
            overflow-x: auto;
        }

        /* Annotation Arrows */
        .annotation {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }

        .annotation-arrow {
            margin: 0 15px;
            color: var(--secondary-color);
        }

        .annotation-text {
            background: var(--highlight-yellow);
            padding: 8px 15px;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        /* Equation Box */
        .equation-box {
            background: var(--bg-light);
            padding: 20px;
            border-radius: 6px;
            margin: 20px 0;
            text-align: center;
        }

        /* Results Section */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .result-card {
            background: var(--bg-light);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .result-card h4 {
            margin-top: 0;
            color: var(--primary-color);
        }

        /* Footer */
        .page-footer {
            text-align: right;
            color: var(--secondary-color);
            font-size: 0.9rem;
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }

        /* Two Column Layout */
        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }

        @media (max-width: 768px) {
            .two-column {
                grid-template-columns: 1fr;
            }
            
            body {
                padding: 20px 10px;
            }
            
            section {
                padding: 20px;
            }
            
            .title-page {
                padding: 40px 20px;
            }
            
            .title-page h1 {
                font-size: 1.8rem;
            }
        }

        /* MathJax spacing */
        mjx-container {
            margin: 10px 0 !important;
        }
    </style>
</head>
<body>
    <div class="document">
        
        <!-- Title Page -->
        <header class="title-page">
            <h1>Implementation of an Isoparametric Membrane Finite Element</h1>
            <div class="course-info">
                Course of Spacecraft Structures<br>
                AY 2017/2018
            </div>
            <div class="author">
                Riccardo Vescovini<br>
                Politecnico di Milano, Department of Aerospace Science and Technology
            </div>
        </header>

        <!-- Introduction - Element Types -->
        <section id="element-types">
            <h2>Introduction – Element Types</h2>
            
            <p>Two element types are considered: 4– and 8–node elements. The numbering of the nodes is reported in the figure.</p>
            
            <figure>
                <img src="images/Lab_05_FEM_membrane/finite_element_types_4_and_8_node.png" alt="4-node and 8-node quadrilateral elements with node numbering">
                <figcaption>Figure 1: 4-node (left) and 8-node (right) quadrilateral elements in the computational domain with \(\xi, \eta \in [-1, 1]\)</figcaption>
            </figure>

            <h3>Shape Functions for 4-Node Element</h3>
            
            <p>The shape functions are defined in the computational domain. For the 4–node element they are:</p>
            
            <figure>
                <img src="images/Lab_05_FEM_membrane/four_node_element_coordinate_system.png" alt="4-node element with coordinate system">
                <figcaption>Figure 2: 4-node quadrilateral element with local coordinate system</figcaption>
            </figure>
            
            <div class="equation-box">
                \[N_1 = \frac{1}{4}(1-\xi)(1-\eta)\]
                \[N_2 = \frac{1}{4}(1+\xi)(1-\eta)\]
                \[N_3 = \frac{1}{4}(1+\xi)(1+\eta)\]
                \[N_4 = \frac{1}{4}(1-\xi)(1+\eta)\]
            </div>

            <figure>
                <img src="images/Lab_05_FEM_membrane/shape_functions_four_node_element.png" alt="3D visualization of shape functions for 4-node element">
                <figcaption>Figure 3: Shape functions of 4-node elements - 3D visualization showing bilinear variation</figcaption>
            </figure>

            <h3>Shape Functions for 8-Node Element</h3>
            
            <p>The shape functions are defined in the computational domain. For the 8–node element they are:</p>
            
            <figure>
                <img src="images/Lab_05_FEM_membrane/eight_node_element_coordinate_system.png" alt="8-node element with coordinate system">
                <figcaption>Figure 4: 8-node quadrilateral element with local coordinate system including mid-side nodes</figcaption>
            </figure>
            
            <div class="equation-box">
                <p><strong>Corner nodes:</strong></p>
                \[N_1 = \frac{1}{4}(1-\xi)(1-\eta)(-\xi-\eta-1)\]
                \[N_2 = \frac{1}{4}(1+\xi)(1-\eta)(\xi-\eta-1)\]
                \[N_3 = \frac{1}{4}(1+\xi)(1+\eta)(\xi+\eta-1)\]
                \[N_4 = \frac{1}{4}(1-\xi)(1+\eta)(-\xi+\eta-1)\]
                
                <p><strong>Mid-side nodes:</strong></p>
                \[N_5 = \frac{1}{2}(1-\xi^2)(1-\eta)\]
                \[N_6 = \frac{1}{2}(1+\xi)(1-\eta^2)\]
                \[N_7 = \frac{1}{2}(1-\xi^2)(1+\eta)\]
                \[N_8 = \frac{1}{2}(1-\xi)(1-\eta^2)\]
            </div>

            <figure>
                <img src="images/Lab_05_FEM_membrane/shape_functions_eight_node_element.png" alt="3D visualization of shape functions for 8-node element">
                <figcaption>Figure 5: Shape functions of 8-node elements - 3D visualization for corner and mid-side nodes</figcaption>
            </figure>

            <div class="page-footer">Course of Spacecraft Structures, AY 2017/2018</div>
        </section>

        <!-- Numerical Integration -->
        <section id="numerical-integration">
            <h2>Introduction – Numerical Integration</h2>
            
            <p>Gauss integration is adopted for integrating the stiffness matrix. The numbering of the integration points, their position and the corresponding weights are summarized here below up to the \(3 \times 3\) integration scheme.</p>
            
            <figure>
                <img src="images/Lab_05_FEM_membrane/gauss_integration_schemes.png" alt="Gauss integration schemes">
                <figcaption>Figure 6: Gauss integration schemes: 1×1, 2×2, and 3×3 rules</figcaption>
            </figure>

            <h3>Integration Rules</h3>
            
            <table>
                <tr>
                    <th>Rule</th>
                    <th>Gauss Points Positions \(x_i\)</th>
                    <th>Gauss Points Weights \(w_i\)</th>
                </tr>
                <tr>
                    <td>\(1 \times 1\)</td>
                    <td>\(x_i = 0\)</td>
                    <td>\(w_i = 2\)</td>
                </tr>
                <tr>
                    <td>\(2 \times 2\)</td>
                    <td>\(x_i = \left\{-1/\sqrt{3}, \quad 1/\sqrt{3}\right\}\)</td>
                    <td>\(w_i = \{1, \quad 1\}\)</td>
                </tr>
                <tr>
                    <td>\(3 \times 3\)</td>
                    <td>\(x_i = \left\{-\sqrt{0.6}, \quad 0, \quad \sqrt{0.6}\right\}\)</td>
                    <td>\(w_i = \{5/9, \quad 8/9, \quad 5/9\}\)</td>
                </tr>
            </table>

            <div class="page-footer">Course of Spacecraft Structures, AY 2017/2018</div>
        </section>

        <!-- Example Problem -->
        <section id="example-problem">
            <h2>Example Problem</h2>
            
            <p>Open-hole test: membrane with center hole, loaded in traction (1/4 of the structure due to the double symmetry of the problem)</p>
            
            <figure>
                <img src="images/Lab_05_FEM_membrane/open_hole_test_problem_setup.png" alt="Open-hole test problem setup">
                <figcaption>Figure 7: Open-hole test problem - full geometry (top) and quarter symmetry model (bottom)</figcaption>
            </figure>

            <h3>Input Data</h3>
            
            <div class="info-box">
                <ul style="list-style: none; margin-left: 0;">
                    <li>\(a = 100 \text{ mm}\) (height)</li>
                    <li>\(b = 150 \text{ mm}\) (width)</li>
                    <li>\(R = 25 \text{ mm}\) (hole radius)</li>
                    <li>\(t = 1 \text{ mm}\) (thickness)</li>
                    <li>\(E = 72 \text{ GPa}\) (Young's modulus)</li>
                    <li>\(\nu = 0.3\) (Poisson's ratio)</li>
                    <li>\(N_{xx} = 20 \text{ N/mm}\) (applied load)</li>
                </ul>
            </div>

            <h3>Mesh and Numbering</h3>
            
            <p>The global reference system, the node and element numbering are taken as reported in the figure (these choices are clearly arbitrary).</p>
            
            <figure>
                <img src="images/Lab_05_FEM_membrane/finite_element_mesh_node_element_numbering.png" alt="Finite element mesh with numbering">
                <figcaption>Figure 8: Finite element mesh showing node IDs (red) and element IDs (black)</figcaption>
            </figure>

            <div class="page-footer">Course of Spacecraft Structures, AY 2017/2018</div>
        </section>

        <!-- Program Overview -->
        <section id="program-overview">
            <h2>Overview of the Program – Main</h2>
            
            <p>The structure of the program consists of three distinct steps:</p>
            <ul>
                <li>the preparation of data (<strong>pre-process</strong>)</li>
                <li>the analysis of the structure (<strong>solution</strong>)</li>
                <li>analysis of results (<strong>post-processing</strong>)</li>
            </ul>

            <p>The three steps are accomplished by the three functions <code class="code-inline">input_open_hole_bilinear_44_els</code> (example taken as reference), <code class="code-inline">fem_solver</code> and <code class="code-inline">plot_def_vs_undef</code> (other post-processing functions can be considered)</p>

            <div class="code-block">
<span class="comment">% --- 1. Pre-process</span>
INPUT = input_open_hole_bilinear_44_els;

<span class="comment">% --- 2. Solution</span>
[ MODEL, PROPERTY, POST ] = fem_solver( INPUT );

<span class="comment">% --- 3. Post-process - plot results</span>
plot_def_vs_undef( MODEL, POST );
            </div>

            <h3>Data Structures</h3>
            
            <p>Three structures are used in the program: MODEL, PROPERTY, POST. Most of data are stored in MODEL, whose fields are:</p>

            <div class="data-structure">
MODEL = 
  struct with fields:
      <span class="field-name">elements:</span> [44×4 double]     <span class="field-desc">% [ID_node1 ID_node2 ID_node3 ID_node4]</span>
      <span class="field-name">int_rule:</span> [1×1 struct]      <span class="field-desc">% structure with integration points and weights</span>
         <span class="field-name">nodes:</span> [60×2 double]      <span class="field-desc">% [x_coord y_coord]</span>
           <span class="field-name">pos:</span> [60×2 double]      <span class="field-desc">% position of the nodal dofs in the global vector</span>
          <span class="field-name">ndof:</span> 120                <span class="field-desc">% total number of dofs</span>
          <span class="field-name">nels:</span> 44                 <span class="field-desc">% total number of elements</span>
        <span class="field-name">nnodes:</span> 60                 <span class="field-desc">% total number of nodes</span>
        <span class="field-name">eltype:</span> 4                  <span class="field-desc">% number of nodes per element</span>
             <span class="field-name">K:</span> [107×107 double]    <span class="field-desc">% stiffness matrix (constrained structure)</span>
             <span class="field-name">F:</span> [107×1 double]      <span class="field-desc">% vector of loads (constrained structure)</span>
   <span class="field-name">constr_dofs:</span> [13×1 double]     <span class="field-desc">% vector of constrained dofs</span>
     <span class="field-name">free_dofs:</span> [1×107 double]    <span class="field-desc">% vector of free dofs</span>
    <span class="field-name">nfree_dofs:</span> 107               <span class="field-desc">% free degrees of freedom</span>
          <span class="field-name">ptrs:</span> [44×8 double]      <span class="field-desc">% vectors of pointers</span>
         <span class="field-name">K_unc:</span> [120×120 double]   <span class="field-desc">% stiffness matrix (unconstrained structure)</span>
         <span class="field-name">F_unc:</span> [120×1 double]     <span class="field-desc">% vector of loads (unconstrained structure)</span>
             <span class="field-name">U:</span> [107×1 double]      <span class="field-desc">% global vector of displacements (constr struct)</span>
         <span class="field-name">U_unc:</span> [120×1 double]     <span class="field-desc">% global vector of displacements (unconstr struct)</span>
            </div>

            <p>The structure PROPERTY stores the elastic properties of the membrane:</p>

            <div class="data-structure">
PROPERTY = 
  struct with fields:
      <span class="field-name">t:</span> 1.00          <span class="field-desc">% thickness</span>
      <span class="field-name">A:</span> [3×3 double]  <span class="field-desc">% membrane constitutive law</span>
            </div>

            <div class="equation-box">
                <p><strong>Membrane Stiffness Matrix:</strong></p>
                \[\mathbf{A} = \frac{Et}{1-\nu^2} \begin{bmatrix} 1 & \nu & 0 \\ \nu & 1 & 0 \\ 0 & 0 & \frac{1-\nu}{2} \end{bmatrix}\]
            </div>

            <p>The structure POST collects data evaluated during post-processing:</p>

            <div class="data-structure">
POST = 
  struct with fields:
        <span class="field-name">sxx_ip:</span> [44×4 double]      <span class="field-desc">% stress sxx at the integration points</span>
        <span class="field-name">syy_ip:</span> [44×4 double]      <span class="field-desc">% stress syy at the integration points</span>
        <span class="field-name">sxy_ip:</span> [44×4 double]      <span class="field-desc">% stress sxy at the integration points</span>
           <span class="field-name">sxx:</span> [44×4 double]      <span class="field-desc">% stress sxx at the corners</span>
           <span class="field-name">syy:</span> [44×4 double]      <span class="field-desc">% stress syy at the corners</span>
           <span class="field-name">sxy:</span> [44×4 double]      <span class="field-desc">% stress sxy at the corners</span>
  <span class="field-name">sxx_centroid:</span> [44×1 double]      <span class="field-desc">% stress sxx at the centroid</span>
  <span class="field-name">syy_centroid:</span> [44×1 double]      <span class="field-desc">% stress syy at the centroid</span>
  <span class="field-name">sxy_centroid:</span> [44×1 double]      <span class="field-desc">% stress sxy at the centroid</span>
            </div>

            <div class="page-footer">Course of Spacecraft Structures, AY 2017/2018</div>
        </section>

        <!-- Step 1: Pre-process -->
        <section id="pre-process">
            <h2>Step 1, Pre-process: input_model</h2>
            
            <p>The input file is written from the user by specifying the characteristics of the model to be analyzed. The data are organized into the structure INPUT, which is divided into different fields:</p>

            <div class="data-structure">
INPUT = 
  struct with fields:
    <span class="field-name">integration_pts:</span> 2               <span class="field-desc">% number of integration pts</span>
           <span class="field-name">elements:</span> [44×4 double]   <span class="field-desc">% [ID_node1 .... ID_node4]</span>
              <span class="field-name">nodes:</span> [60×2 double]   <span class="field-desc">% [x_coord y_coord]</span>
                  <span class="field-name">E:</span> 72000           <span class="field-desc">% Young's modulus</span>
                 <span class="field-name">nu:</span> 0.3000          <span class="field-desc">% Poisson's ratio</span>
                  <span class="field-name">t:</span> 1.0000          <span class="field-desc">% thickness</span>
               <span class="field-name">load:</span> [5×3 double]    <span class="field-desc">% [ID_node dof magnitude]</span>
                <span class="field-name">spc:</span> [13×2 double]   <span class="field-desc">% [ID_node constrained_dof]</span>
            </div>

            <h3>Element Connectivity</h3>
            
            <figure>
                <img src="images/Lab_05_FEM_membrane/element_connectivity_mesh_detail.png" alt="Element connectivity detail">
                <figcaption>Figure 9: Element connectivity - Element 1 connects nodes 1, 6, 7, 2; Element 2 connects nodes 2, 7, 8, 3</figcaption>
            </figure>

            <div class="code-block">
INPUT.elements = 
     1       6       7       2    <span class="comment">% Element 1: nodes 1, 6, 7 and 2</span>
     2       7       8       3    <span class="comment">% Element 2: nodes 2, 7, 8 and 3</span>
     3       8      10       4
     4      10      11       5
     ...
    54      59      60      55
            </div>

            <h3>Boundary Conditions</h3>
            
            <figure>
                <img src="images/Lab_05_FEM_membrane/boundary_conditions_mesh.png" alt="Boundary conditions">
                <figcaption>Figure 10: Boundary conditions - nodes constrained along x (left edge) and y (bottom edge) directions</figcaption>
            </figure>

            <div class="code-block">
INPUT.spc = 
     1       1    <span class="comment">% Node 1, constrained along x</span>
     2       1    <span class="comment">% Node 2, constrained along x</span>
     3       1
     ...
    51       2    <span class="comment">% Node 51, constrained along y</span>
    56       2    <span class="comment">% Node 56, constrained along y</span>
            </div>

            <h3>Applied Loads</h3>
            
            <figure>
                <img src="images/Lab_05_FEM_membrane/applied_loads_mesh.png" alt="Applied loads">
                <figcaption>Figure 11: Applied loads at right edge nodes</figcaption>
            </figure>

            <div class="code-block">
INPUT.load = 
    56       1      125    <span class="comment">% Node 56, loaded along x, force magnitude 125</span>
    57       1      250    <span class="comment">% Node 57, loaded along x, force magnitude 250</span>
    58       1      250
    59       1      250
    60       1      125
            </div>

            <div class="page-footer">Course of Spacecraft Structures, AY 2017/2018</div>
        </section>

        <!-- Step 2: Solution - fem_solver -->
        <section id="fem-solver">
            <h2>Step 2, Solution: fem_solver</h2>
            
            <p>The function fem_solver represents the core of the program, and is divided into a number of functions:</p>

            <div class="code-block">
<span class="keyword">function</span> [ MODEL, PROPERTY, POST ] = fem_solver( INPUT )

<span class="comment">% --- Set model</span>
[ MODEL, PROPERTY, POST ] = set_model( INPUT );

<span class="comment">% --- Set pointers</span>
MODEL = set_pointers( MODEL );

<span class="comment">% --- Build & assembly matrices</span>
MODEL = build_K_matrix( MODEL, PROPERTY );

<span class="comment">% --- Impose constraints and solve</span>
MODEL = solve_structure( MODEL );

<span class="comment">% --- Stress recovery</span>
POST = stress_recovery( MODEL, PROPERTY, POST );
            </div>

            <h3>DOF Organization</h3>
            
            <p>DOFs are sorted as:</p>
            \[\mathbf{U}^{\mathrm{T}} = \begin{bmatrix} U_x^1 & U_x^2 & \ldots & U_x^N & U_y^1 & U_y^2 & \ldots & U_y^N \end{bmatrix}\]

            <h3>set_pointers</h3>
            
            <p>The function writes the pointers associated with the generic i-th element in the field MODEL.ptrs:</p>

            <div class="code-block">
MODEL.ptrs =
     1       6       7       2      61      66      67      62    <span class="comment">% Position of dofs of element 1</span>
     2       7       8       3      62      67      68      63    <span class="comment">% Position of dofs of element 2</span>
     3       8      10       4      63      68      70      64
     4      10      11       5      64      70      71      65
            </div>

            <div class="page-footer">Course of Spacecraft Structures, AY 2017/2018</div>
        </section>

        <!-- Equations Reminder -->
        <section id="equations">
            <h2>Step 2, Solution: Equations Reminder</h2>
            
            <h3>Jacobian of the Transformation</h3>
            
            <div class="equation-box">
                \[\mathbf{J} = \begin{bmatrix} N_{1,\xi} & N_{2,\xi} & \ldots & N_{N,\xi} \\ N_{1,\eta} & N_{2,\eta} & \ldots & N_{N,\eta} \end{bmatrix} \begin{bmatrix} x_1 & y_1 \\ \vdots & \vdots \\ x_N & y_N \end{bmatrix}\]
            </div>
            
            <p>where N is the number of nodes (4 for bilinear element; 8 for biquadratic element)</p>

            <div class="two-column">
                <div class="highlight-box">
                    <strong>First matrix:</strong> Derivatives in the computational domain; available by the definitions of \(N_i\)
                </div>
                <div class="highlight-box">
                    <strong>Second matrix:</strong> Coordinates of the nodes composing the element
                </div>
            </div>

            <h3>Derivatives of Shape Functions</h3>
            
            <p>Derivatives of the shape functions with respect to x and y:</p>
            
            <div class="equation-box">
                \[\begin{bmatrix} N_{1,x} & N_{2,x} & \ldots & N_{N,x} \\ N_{1,y} & N_{2,y} & \ldots & N_{N,y} \end{bmatrix} = \mathbf{J}^{-1} \begin{bmatrix} N_{1,\xi} & N_{2,\xi} & \ldots & N_{N,\xi} \\ N_{1,\eta} & N_{2,\eta} & \ldots & N_{N,\eta} \end{bmatrix}\]
            </div>

            <h3>B-Matrix</h3>
            
            <div class="equation-box">
                \[\mathbf{B} = \begin{bmatrix} N_{1,x} & \ldots & N_{N,x} & 0 & \ldots & 0 \\ 0 & \ldots & 0 & N_{1,y} & \ldots & N_{N,y} \\ N_{1,y} & \ldots & N_{N,y} & N_{1,x} & \ldots & N_{N,x} \end{bmatrix}\]
            </div>

            <h3>Stiffness Matrix</h3>
            
            <div class="equation-box">
                \[\mathbf{K} = \int_{-1}^{1} \int_{-1}^{1} \mathbf{B}^{\mathrm{T}} \mathbf{A} \mathbf{B} \det \mathbf{J} \, \mathrm{d}\xi \, \mathrm{d}\eta = \sum_{i=1}^{N_{ip}} \sum_{j=1}^{N_{ip}} w_{ij} \mathbf{B}^{\mathrm{T}}(\xi_i, \eta_j) \mathbf{A} \mathbf{B}(\xi_i, \eta_j) \det \mathbf{J}\]
                
                <p>with:</p>
                \[\mathbf{A} = \mathbf{C}t = \frac{Et}{1-\nu^2} \begin{bmatrix} 1 & \nu & 0 \\ \nu & 1 & 0 \\ 0 & 0 & \frac{1-\nu}{2} \end{bmatrix}\]
            </div>

            <div class="page-footer">Course of Spacecraft Structures, AY 2017/2018</div>
        </section>

        <!-- build_K_matrix -->
        <section id="build-k-matrix">
            <h2>Step 2, Solution: build_K_matrix</h2>
            
            <div class="code-block">
<span class="keyword">function</span> MODEL = build_K_matrix( MODEL, PROPERTY )

A = PROPERTY.A;

<span class="comment">% --- Integration rule parameters</span>
xGauss = MODEL.int_rule.x;
wGauss = MODEL.int_rule.w;
nint_p = length( xGauss );

<span class="keyword">for</span> i = 1 : MODEL.nels    <span class="comment">% Loop over the elements</span>

    <span class="comment">% --- Initialize</span>
    K_el = zeros( 2 * MODEL.eltype, 2 * MODEL.eltype );
    
    <span class="comment">% --- Matrix of nodal coordinates</span>
    el_nodes = MODEL.elements( i, : );
    xy_nodes = [ MODEL.nodes( el_nodes, 1 ) MODEL.nodes( el_nodes, 2 ) ];
    
    <span class="comment">% --- Integrate stiffness matrix</span>
    <span class="keyword">for</span> iG = 1 : nint_p      <span class="comment">% Loop over x- and y-direction</span>
        <span class="keyword">for</span> jG = 1 : nint_p  <span class="comment">% for numerical integration</span>
        
            xi  = xGauss( jG );
            eta = xGauss( iG );
            
            <span class="comment">% Build matrix B and the Jacobian of the isoparametric transformation</span>
            [ B, detJ ] = get_B_matrix( xi, eta, xy_nodes );
            
            <span class="comment">% --- Stiffness matrix</span>
            K_el = K_el + wGauss( iG ) * wGauss( jG ) * ( B' * A * B * detJ );
            
        <span class="keyword">end</span>
    <span class="keyword">end</span>
    
    <span class="comment">% --- Assemble contribution</span>
    ptrs = MODEL.ptrs( i, : );
    MODEL.K( ptrs, ptrs ) = MODEL.K( ptrs, ptrs ) + K_el;

<span class="keyword">end</span>
            </div>

            <div class="page-footer">Course of Spacecraft Structures, AY 2017/2018</div>
        </section>

        <!-- Stress Recovery -->
        <section id="stress-recovery">
            <h2>Step 2, Solution: stress_recovery</h2>
            
            <p>Once the nodal displacements are available, it is possible to determine the strains and the stresses in any desired position. Generally, a good strategy consists in evaluating the stresses <u>at the integration points</u> (another common approach consists in evaluating the stresses at the "Barlow points", viz. the integration points corresponding to an integration scheme with N-1 points)</p>

            <h3>Stresses at the Integration Points</h3>
            
            <figure>
                <img src="images/Lab_05_FEM_membrane/stress_evaluation_integration_points.png" alt="Stress evaluation at integration points">
                <figcaption>Figure 12: 4-node element with 2×2 integration points for stress evaluation</figcaption>
            </figure>

            <div class="equation-box">
                \[\begin{Bmatrix} \sigma_{xx}(\xi_i, \eta_j) \\ \sigma_{yy}(\xi_i, \eta_j) \\ \sigma_{xy}(\xi_i, \eta_j) \end{Bmatrix} = \mathbf{CB}(\xi_i, \eta_j) \mathbf{U}\]
                <p>(B matrix evaluated at the integration points)</p>
            </div>

            <p>In general, it can be useful to evaluate the stresses in correspondence of the nodes. Indeed, the integration points are inside the element, while the maximum levels of stresses can be reached on the outer positions (consider, for instance, the planar bending of a beam). The direct evaluation of the stresses is not a good choice, as poor quality results are obtained.</p>

            <h3>Interpolation Scheme</h3>
            
            <p>A common strategy consists in adopting an interpolation scheme, where a polynomial expression, consistent with the order of the integration rule adopted, is used.</p>

            <p>For a \(2 \times 2\) integration rule, the stresses are available at four integration points. The interpolation scheme is then taken in the form:</p>
            
            \[\sigma_{ik}(\xi, \eta) = a_0 + a_1\xi + a_2\eta + a_3\xi\eta\]

            <p>and the constants \(a_i\) are obtained by solving the linear system obtained by imposing:</p>
            
            <div class="equation-box">
                \[\begin{cases} a_0 + a_1\xi_1 + a_2\eta_1 + a_3\xi_1\eta_1 = \sigma_{ik}(\xi_1, \eta_1) & \text{integration point 1} \\ \vdots \\ a_0 + a_1\xi_4 + a_2\eta_4 + a_3\xi_4\eta_4 = \sigma_{ik}(\xi_4, \eta_4) & \text{integration point 4} \end{cases}\]
            </div>

            <p>In a similar manner, for a \(3 \times 3\) integration rule, the interpolation scheme can be taken as:</p>
            
            \[\sigma_{ik}(\xi, \eta) = a_0 + a_1\xi + a_2\eta + a_3\xi\eta + a_4\xi^2 + a_5\eta^2 + a_6\xi^2\eta + a_7\xi\eta^2 + a_8\xi^2\eta^2\]
            
            <p>and the linear system to be solved has dimension 9.</p>

            <div class="page-footer">Course of Spacecraft Structures, AY 2017/2018</div>
        </section>

        <!-- Exercise -->
        <section id="exercise">
            <h2>Exercise</h2>
            
            <ul>
                <li>Complete the program by writing the missing parts of the code; consider both 4- and 8-node elements</li>
                <li>Analyze the problems reported next to compare the correctness of your implementation</li>
            </ul>

            <div class="page-footer">Course of Spacecraft Structures, AY 2017/2018</div>
        </section>

        <!-- Results: Jacobians -->
        <section id="results-jacobians">
            <h2>Results: Jacobians</h2>
            
            <figure>
                <img src="images/Lab_05_FEM_membrane/jacobian_matrix_element_distortion.png" alt="Jacobian matrix values for different elements">
                <figcaption>Figure 13: Finite element mesh showing elements analyzed for Jacobian comparison</figcaption>
            </figure>

            <p>\(\mathbf{J}^i(\xi_j, \eta_j)\): Jacobian of the element i at the integration point j</p>

            <p>The ratio between the elements of the Jacobian matrix provides a measure of the geometric deformation of the element. In particular, the diagonal terms furnish a measure of the geometric «stretching» of the elements, while the extra-diagonal elements provides a measure of the distortion.</p>

            <h3>Jacobian Matrices Comparison</h3>

            <div class="result-card">
                <h4>Element 1 (stretched and slightly distorted)</h4>
                \[\mathbf{J}^1(\xi_1, \eta_1) = \begin{bmatrix} 2.6400 & -0.2275 \\ 0.2014 & 3.1377 \end{bmatrix}\]
            </div>

            <div class="result-card">
                <h4>Element 27 (stretched and relatively distorted)</h4>
                \[\mathbf{J}^{27}(\xi_1, \eta_1) = \begin{bmatrix} 5.3912 & -0.3065 \\ 3.1815 & 3.7338 \end{bmatrix}\]
            </div>

            <div class="result-card">
                <h4>Element 33 (stretched but not distorted)</h4>
                \[\mathbf{J}^{33}(\xi_1, \eta_1) = \begin{bmatrix} 4.1667 & 0 \\ 0.0000 & 6.2500 \end{bmatrix}\]
            </div>

            <div class="page-footer">Course of Spacecraft Structures, AY 2017/2018</div>
        </section>

        <!-- Results: Deformed Shape -->
        <section id="results-displacement">
            <h2>Results: Deformed Shape and Displacement Contour</h2>
            
            <figure>
                <img src="images/Lab_05_FEM_membrane/deformed_shape_displacement_contour_comparison.png" alt="Deformed shape and displacement contours">
                <figcaption>Figure 14: Deformed shape (left) and displacement contours (right) for meshes with 44, 570, and 2400 bilinear elements</figcaption>
            </figure>

            <div class="page-footer">Course of Spacecraft Structures, AY 2017/2018</div>
        </section>

        <!-- Results: Stress Components -->
        <section id="results-stress">
            <h2>Results: Stress Components Contour</h2>
            
            <figure>
                <img src="images/Lab_05_FEM_membrane/stress_components_contour_comparison.png" alt="Stress component contours">
                <figcaption>Figure 15: Stress component contours (\(\sigma_{xx}\), \(\sigma_{yy}\), \(\sigma_{xy}\)) for three mesh refinement levels</figcaption>
            </figure>

            <h3>Maximum Stress Values</h3>
            
            <table>
                <tr>
                    <th>Mesh</th>
                    <th>\(\sigma_{xx,\max}\) (MPa)</th>
                    <th>\(\sigma_{yy,\max}\) (MPa)</th>
                    <th>\(\sigma_{xy,\max}\) (MPa)</th>
                </tr>
                <tr>
                    <td>44 elements</td>
                    <td>78.14</td>
                    <td>32.89</td>
                    <td>12.44</td>
                </tr>
                <tr>
                    <td>570 elements</td>
                    <td>89.32</td>
                    <td>40.80</td>
                    <td>19.64</td>
                </tr>
                <tr>
                    <td>2400 elements</td>
                    <td>90.31</td>
                    <td>41.91</td>
                    <td>21.45</td>
                </tr>
            </table>

            <div class="page-footer">Course of Spacecraft Structures, AY 2017/2018</div>
        </section>

        <!-- Results: Summary Table -->
        <section id="results-summary">
            <h2>Results: Summary and Comments</h2>
            
            <h3>Summary of Results: Displacements, Stresses, Energies</h3>
            
            <table>
                <tr>
                    <th rowspan="2"></th>
                    <th colspan="3">4-nodes</th>
                    <th colspan="3">8-nodes</th>
                </tr>
                <tr>
                    <th>44</th>
                    <th>570</th>
                    <th>2400</th>
                    <th>44</th>
                    <th>570</th>
                    <th>2400</th>
                </tr>
                <tr>
                    <td>\(U_{x,max}\) (mm)</td>
                    <td>0.0372</td>
                    <td>0.0382</td>
                    <td>0.0383</td>
                    <td>0.0381</td>
                    <td>0.0383</td>
                    <td>0.0383</td>
                </tr>
                <tr>
                    <td>\(U_{y,max}\) (mm)</td>
                    <td>0.0195</td>
                    <td>0.0209</td>
                    <td>0.0210</td>
                    <td>0.0208</td>
                    <td>0.0210</td>
                    <td>0.0210</td>
                </tr>
                <tr>
                    <td>\(|\sigma_{xx,max}|\) (MPa)</td>
                    <td>78.1374</td>
                    <td>89.3160</td>
                    <td>90.9138</td>
                    <td>86.2614</td>
                    <td>90.4516</td>
                    <td>91.3662</td>
                </tr>
                <tr>
                    <td>\(|\sigma_{yy,max}|\) (MPa)</td>
                    <td>32.8878</td>
                    <td>40.8042</td>
                    <td>41.9088</td>
                    <td>38.8173</td>
                    <td>41.6473</td>
                    <td>42.2574</td>
                </tr>
                <tr>
                    <td>\(|\sigma_{xy,max}|\) (MPa)</td>
                    <td>12.4434</td>
                    <td>19.6433</td>
                    <td>21.4515</td>
                    <td>17.7873</td>
                    <td>21.9655</td>
                    <td>22.7565</td>
                </tr>
                <tr>
                    <td>\(U\) (N mm)</td>
                    <td>16.1996</td>
                    <td>16.5499</td>
                    <td>16.5738</td>
                    <td>16.5151</td>
                    <td>16.5776</td>
                    <td>16.5807</td>
                </tr>
                <tr>
                    <td>\(\Pi = U + V\) (N mm)</td>
                    <td>-16.1996</td>
                    <td>-16.5499</td>
                    <td>-16.5738</td>
                    <td>-16.5151</td>
                    <td>-16.5776</td>
                    <td>-16.5807</td>
                </tr>
            </table>

            <h3>Key Observations</h3>
            
            <ul>
                <li><strong>Convergence:</strong> The convergence of the solution can be observed both in terms of displacements and stress components. The quantities are referred to one single point, thus provide information on the local behaviour.</li>
                
                <li><strong>Displacement underestimation:</strong> The displacements tend to be underestimated. In this example, coarser meshes are associated with smaller displacements with respect to finer ones. Indeed a coarse mesh is stiffer in comparison to a finer one.</li>
                
                <li><strong>Stress underestimation:</strong> Similarly, the stresses tend to be underestimated. This is an important aspect to take into account during the analysis phase, as unconservative results can be obtained due to an excessively coarse mesh.</li>
                
                <li><strong>Different convergence rates:</strong> The results illustrate the different rate of convergence between displacements and stresses. While a 4-node mesh with 570 elements provides a good estimate of the displacement field, a higher refinement level is needed to properly capture the stress field.</li>
                
                <li><strong>h-refinement vs p-refinement:</strong> The quality of the prediction can be improved by reducing the size of the mesh (h-refinement), or by increasing the order of the interpolating scheme (p-refinement).</li>
                
                <li><strong>Energy convergence:</strong> The strain energy U (or, equivalently, the total potential energy) provides a good measure of the convergence at global level. Note that the strain energy increases as the refinement of the mesh is increased. Indeed, a less stiff model is capable of storing a higher amount of deformation energy.</li>
            </ul>

            <div class="page-footer">Course of Spacecraft Structures, AY 2017/2018</div>
        </section>

        <!-- Numerical Integration Comments -->
        <section id="integration-comments">
            <h2>Results: Numerical Integration Comments</h2>
            
            <h3>Gauss Integration Remarks</h3>
            
            <ul>
                <li>An integration of order P allows to integrate exactly a polynomial expressions of order 2P-1. For instance, a cubic expression can be integrated exactly by taking P=2.</li>
                
                <li>If the element is regular (no distortion), the stiffness matrix is quadratic (in case of 4-node elements). A rule of order 2 suffices for integrating exactly. This is true if and only if the elements are not distorted. Indeed, the effect of distortion is to transform the expression of the stiffness contribution into a more complex function via the Jacobian of the transformation. In the presence of distorted elements, an integration of higher order than 2 may be needed even for bilinear elements.</li>
            </ul>

            <h3>Stiffness Matrix: Distorted Element (Element 27)</h3>
            
            <figure>
                <img src="images/Lab_05_FEM_membrane/element_27_distorted_mesh.png" alt="Element 27 distorted">
                <figcaption>Figure 16: Element 27 - distorted element near hole region</figcaption>
            </figure>

            <p>Due to the distorted shape of the element, the contributions of the stiffness matrix obtained using 2 and 3 points are different:</p>

            <div class="matrix-display">
* --- Using 2 x 2 points
K_el = 1.0e+04 *
    2.6858   -1.6702   -0.6986   -0.3170    0.2167    0.9910   -0.7376   -0.4701
   -1.6702    4.6628   -0.1259   -2.8668    1.1888   -2.1471   -0.7180    1.6763
   -0.6986   -0.1259    2.2720   -1.4475   -0.7376   -0.5202    0.3252    0.9326
   ...

* --- Using 3 x 3 points
K_el = 1.0e+04 *
    2.6868   -1.6711   -0.6978   -0.3179    0.2164    0.9913   -0.7378   -0.4698
   -1.6711    4.6637   -0.1266   -2.8660    1.1891   -2.1473   -0.7178    1.6760
   -0.6978   -0.1266    2.2726   -1.4482   -0.7378   -0.5200    0.3250    0.9328
   ...
            </div>

            <h3>Stiffness Matrix: Regular Element (Element 33)</h3>
            
            <figure>
                <img src="images/Lab_05_FEM_membrane/element_33_regular_mesh.png" alt="Element 33 regular">
                <figcaption>Figure 17: Element 33 - regular rectangular element</figcaption>
            </figure>

            <p>The element is regular and is integrated exactly using \(2 \times 2\) points (no distinction exists with the stiffness matrix obtained with \(3 \times 3\) points).</p>

            <h3>Strain Energy vs Integration Rule</h3>
            
            <table>
                <tr>
                    <th rowspan="2">Int rule</th>
                    <th colspan="3">4-nodes</th>
                    <th colspan="3">8-nodes</th>
                </tr>
                <tr>
                    <th>\(1 \times 1\)</th>
                    <th>\(2 \times 2\)</th>
                    <th>\(3 \times 3\)</th>
                    <th>\(1 \times 1\)</th>
                    <th>\(2 \times 2\)</th>
                    <th>\(3 \times 3\)</th>
                </tr>
                <tr>
                    <td>44 els</td>
                    <td>Hourgl.</td>
                    <td>16.1996</td>
                    <td>16.1989</td>
                    <td>/</td>
                    <td>16.5206</td>
                    <td>16.5151</td>
                </tr>
                <tr>
                    <td>570 els</td>
                    <td>16.5724</td>
                    <td>16.5499</td>
                    <td>16.5499</td>
                    <td>/</td>
                    <td>16.5776</td>
                    <td>16.5776</td>
                </tr>
                <tr>
                    <td>2400 els</td>
                    <td>16.5793</td>
                    <td>16.5738</td>
                    <td>16.5738</td>
                    <td>/</td>
                    <td>16.5807</td>
                    <td>16.5807</td>
                </tr>
            </table>

            <ul>
                <li>For a given mesh, the effect of increasing the number of integration points is to reduce the strain energy. This means that improving the quality of the integration leads to stiffer model, viz. lower strain energy (recall that lower strain energy means a stiffer structure).</li>
                
                <li>For refined meshes (2400 els) the elements are very small, thus the distortion is slight. Improving the quality of the integration has a minor impact on the solution, as the elements are almost regular.</li>
            </ul>

            <h3>Hourglassing Effects</h3>
            
            <p>Note that reducing the order of integration can lead to hourglassing effects, as in the case of 44 bilinear elements integrated with one single point. This is clearly visible from the deformed pattern which is characterized by the typical hourglass shape of some elements.</p>

            <figure>
                <img src="images/Lab_05_FEM_membrane/hourglass_mode_deformation.png" alt="Hourglass mode deformation">
                <figcaption>Figure 18: Deformed shape characterized by zero energy modes (hourglassing)</figcaption>
            </figure>

            <div class="page-footer">Course of Spacecraft Structures, AY 2017/2018</div>
        </section>

        <!-- Comparison with Abaqus -->
        <section id="abaqus-comparison">
            <h2>Results: Comparison with Abaqus</h2>
            
            <h3>Displacement Field</h3>
            
            <figure>
                <img src="images/Lab_05_FEM_membrane/displacement_field_abaqus_matlab_comparison.png" alt="Displacement field comparison">
                <figcaption>Figure 19: Comparison of displacement field contours (\(U_x\), \(U_y\), \(U_{tot}\)) between Abaqus (top) and Matlab (bottom)</figcaption>
            </figure>

            <h3>Stress Field</h3>
            
            <figure>
                <img src="images/Lab_05_FEM_membrane/stress_field_abaqus_matlab_comparison.png" alt="Stress field comparison">
                <figcaption>Figure 20: Comparison of stress field contours (\(\sigma_{xx}\), \(\sigma_{yy}\), \(\sigma_{xy}\)) between Abaqus (top) and Matlab (bottom)</figcaption>
            </figure>

            <h3>Numerical Verification: Element 346</h3>
            
            <p>Stresses at the nodes of element 346 (mesh 570 elements, 4-nodes):</p>

            <div class="two-column">
                <div>
                    <h4>Abaqus .dat file</h4>
                    <div class="code-block">
THE FOLLOWING TABLE IS PRINTED AT THE NODES 
FOR ELEMENT TYPE M3D4 AND ELEMENT SET EGLOBAL

  ELEMENT    ND   FOOT-   S11      S22      S12
                  NOTE
      346     1          93.19    5.183    0.6192
      346    17          92.96    5.657   -4.854
      346    18          74.91    0.1884  -4.102
      346     2          75.06   -0.2584   0.8615
                    </div>
                </div>
                <div>
                    <h4>Matlab results</h4>
                    <div class="code-block">
>> POST.sxx(346,:)
ans =
    93.1938   75.0562   74.9058   92.9648

>> POST.syy(346,:)
ans =
     5.1829   -0.2584    0.1884    5.6567

>> POST.sxy(346,:)
ans =
     0.6192    0.8615   -4.1022   -4.8540
                    </div>
                </div>
            </div>

            <div class="info-box">
                <strong>Validation:</strong> The stress values from the Matlab implementation match those from Abaqus, confirming the correctness of the finite element code.
            </div>

            <div class="page-footer">Course of Spacecraft Structures, AY 2017/2018</div>
        </section>

    </div>
</body>
</html>